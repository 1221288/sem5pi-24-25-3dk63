# US 1002

Author : 1221959

## 1. Context

It is the first time this task is being developed.


## 2. Requirements


**US 1002** As Customer Manager, I want to register a job opening.

- Priority: 1
- References: Alternatively this can be achieved by a bootstrap process

A job opening includes:
- Job Reference: A unique identifier of the job opening (generated by the system, for instance based on the customer code followed by a sequential number);
-  Title or function: Such as "front end programmer";
-  Contract Type: Such as full-time or part-time;
-  Mode: Such as remote, hybrid, onsite;
-  Address: Address for;
-  Company: Customer name (only companys that are responsabilities of the customer manager logged in);
-  Number of vacancies;
-  Description;
-  Requirements The job requirements specification to use for this opening.

## 2.1. Client Clarifications

## Question 7

> No contexto em que o Customer Manager regista uma oferta de emprego, como são selecionados/definidos os requisitos para essa job offer?

O Customer manager regista a job opening (US 1002) e de seguida (normalmente) seleciona qual o requirements specification que é adequado a esse job opening. O requirements specification será um dos que foi “criado” pelo language engineer e registado no sistema

## Question 88

> US1002 – Quando o Customer Manager regista uma job offer, é ele que cria as requirement specifications e as interview models ou é-lhe dada uma lista destes para ele selecionar?

Existe a US1002 e as US1009 e US1011. Penso que está claro qual a responsabilidade de cada uma. A criação dos modelos das entrevistas e dos requisitos é um caso de uso especifico e com um US especifica para registar no sistema os respectivos plugins (US1008).

## Question 91

>Validez de uma Job Openings – A nossa questão principal seria: quando é que uma job opening é considerada válida? Tendo em conta as funcionalidades 1002, 1007, 1009, surgiu-nos uma duvida relativamente às job openings e à sua constituiçao. Na US1002, é suposto resgistar uma job opening e apenas depois, na US1009, devemos selecionar os requirements specifications para a dada job opening. Posto isto, aquando o registo da job opening, esta não iria possuir toda a informaçao obrigatória como requerido. Assim sendo, deveria haver uma ligação direta entre estas user stories de forma a que, aquando o registo, passamos automaticamente a selecionar os requirements obtendo assim uma job opening válida? Adicionalmente, queremos esclarecer se o recruitment process é algo obrigatório para a validez de um job opening

O product owner não é especialista do dominio da solução (apenas têm conhecimentos do problema) mas, quanto à primeira questão, sugere que talvez user stories não sejam (podem não ser) opções de menu “distintas”. Quanto à segunda questão (recruitment process) julgo que também está mais ligada à solução que ao problema, pelo que não vou sugerir nada que possa até complicar mais do que esclarecer.

## Question 109

>[US1002] Modo de Trabalho e Tipo de Contrato- Numa job opening, o tipo de contrato e o modo de trabalho são elementos fixos, na medida em que os tipos apresentados na documentação são estáticos e não mudam, ou poderão haver mais tipos deste dois elementos?

## Question 114

>US1002 - Um customer manager tem a responsabilidade de criar job openings para os customers em que é responsável. Na hora da criação da job opening, como é que ele refere qual é o customer daquela job opening? Seleciona um customer dentro dos que está responsável?

Sim, pode ser como indica.

## Question 115

>US1002, 1007, 1009 - Na US1002 ao registar um job opening é imperativo selecionar também o job requirement e/ou as fases de recrutamento?

## Question 117

>– US1002 - Relativamente aos atributos Contract Type e Mode de um job opening. Os Contract Types são só "full-time or part-time" ou pode haver outros, exemplo part-time de 15 horas, part-time de 20 horas, etc...? O mesmo para Mode, só existe os três tipos mencionados no enunciado "Such as remote, hybrid, onsite" ou podem existir mais?

Ver Q109


## 3. Analysis

### 3.1. Domain Model

![domain model](../../global-artifacts/02.analysis/domain_model.png) "Domain model")

### 3.2. Use case diagram

![use case diagram](out/US1002_UCD.svg "Use case diagram")


## 4. Design

### 4.1. Realization

### 4.2. Applied Patterns

- **Repository:** This is used to store the jobOffers. This is done to allow the persistence of the enrollments and to allow the use of the enrollments in other parts of the application.

### 4.3. Tests

#### 4.3.1.1 Register job offer

![login.png](assets%2Flogin.png)


```
1-entrar como customerManager
2-selecionar a opção 2
3-selecionar a opção 2 novamanente
4- inserir os dados pedidos
5. Em caso de sucesso, a job offer foi criada.
```

**Test 1:** _Verifies that it is not possible to create an instance of the Joboffer class with null values._

```
  @Test
    void testCreateJobOpeningWithNullValues() {
        assertThrows(NullPointerException.class, () -> 
        new JobOffer(null, null, null, null, null, null, null, null, null, null));
    }

```

**Test 2:** _Verifies that it is possible to create an instance of the Joboffer class with valid values._

```
    @Test
    void testCreateJobOpeningWithValidValues() {
        JobOffer jobOffer = new JobOffer("jobReference", "title", "contractType", "mode", "address", "company", 1, "description", "requirements");
        assertNotNull(jobOffer);
    }
```

**Test 3:** _Verifies that the job reference is generated correctly._

```
    @Test
    void generatingValidReference() {
        CustomerCode customerCode = new CustomerCode("ABC");
        Company company = new Company("Company", customerCode, "teste@teste.com");
        JobOffer jobOffer = new JobOffer();
        Reference reference = jobOffer.generateReference(company.getCustomerCode().toString());
        assertTrue(reference.getValue().startsWith(company.getCustomerCode().toString()));
    }
```

## 5. Implementation
## 5.1 RegisterJobOpeningController
```java
public class RegisterJobOpeningController {


    private JobOfferRepository jobOfferRepository= PersistenceContext.repositories().jobOffers();
    private CompanyRepository companyRepository = PersistenceContext.repositories().companies();
    private final AuthorizationService authorizationService = AuthzRegistry.authorizationService();


    public JobOffer registerJobOpening(Reference reference, Function function, ContractType contractType, Mode mode, Address address, Company company, NumberOfVacancies nrOfVacancies, Description description, JobRequirements requirements) {

        authorizationService.ensureAuthenticatedUserHasAnyOf(Jobs4uRoles.POWER_USER, Jobs4uRoles.CUSTOMER_MANAGER);


        // Get the email of the user with the current session
        String managerEmail = getManagerEmail();

        // Create the job offer using the builder
        JobOffer jobOffer = new JobOfferBuilder()
                .reference(reference)
                .function(function)
                .contractType(contractType)
                .mode(mode)
                .address(address)
                .company(company)
                .nrOfVacancies(nrOfVacancies)
                .description(description)
                .requirements(requirements)
                .managerEmail(managerEmail)
                .build();

        // Salvar a oferta de emprego no repositório
        jobOfferRepository.save(jobOffer);

        return jobOffer;
    }

    private String getManagerEmail() {
        authorizationService.ensureAuthenticatedUserHasAnyOf(Jobs4uRoles.POWER_USER, Jobs4uRoles.CUSTOMER_MANAGER);
        Optional<UserSession> userSessionOptional = authorizationService.session();
        UserSession userSession = userSessionOptional.get();
        SystemUser authenticatedUser = userSession.authenticatedUser();
        return authenticatedUser.email().toString();
    }

    public boolean isCompanyExists (String companyName){
        return companyRepository.exists(companyName);
    }

    public Iterable<Company> getCompanies(){
        return companyRepository.findByManager(getManagerEmail());
    }

    public boolean ListCompanies(){
        Iterable<Company> companies = getCompanies();
        if (!companies.iterator().hasNext()) {
            System.out.println("No companies found");
            return true;
        }
        for (Company company : companies) {
            System.out.println(company.toString());
        }
        return false;
    }

    public Company getCompany(String companyName){
        return companyRepository.findByName(companyName).iterator().next();
    }

    public boolean Available(){
        Iterable<Company> companies = getCompanies();
        if (!companies.iterator().hasNext()) {
            return true;
        }
        return false;
    }

}
```


## 6. Integration & Demonstration
![RegisterJobOpening.png](assets%2FRegisterJobOpening.png)

## 7. Observations

- N/a